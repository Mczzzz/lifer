<!DOCTYPE html>
  <html>
  
    <head>
<!--       <script type="text/javascript" src="lib/jquery-3.3.1.slim.min.js"></script> -->
      <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
      <script src="{{ asset('bundles/app/lib/pixi.min.js') }}"></script>
      <script src="{{ asset('bundles/app/app/components/elements/menu/adder.js') }}"></script>
      <script src="{{ asset('bundles/app/app/components/elements/preview/pict.js') }}"></script>
      <script src="{{ asset('bundles/app/app/views/layout.js') }}"></script>
      <meta charset="utf-8" />
      <title>App.repas</title>
    </head>

    <style>
      * {
          margin: 0;
          padding: 0;
        }

      #divPhoto{
        visibility:hidden;
        position:absolute;
      }

      #divText{
        visibility:hidden;
        position:absolute;
        left: 60px;
        top: 800px;
      }
    </style>


    <body>
      <div id="divPhoto">
      <input id='photo' type="file" accept="image/*" capture="camera">
      <img id='photoTmp' src="" height="200" alt="Aperçu de l’image...">

      <div>
      <div id="divText">
      <textarea id='textInput' row="3" cols="50" ></textarea>

      <div>

    </body>

    <script>



          app = new PIXI.Application(window.innerWidth, window.innerHeight, { backgroundColor : 0x000000, 
                                                                                  antialias : true
                                                                                }
                                        );

          document.body.appendChild(app.view);

          app.stage.interactive = true;

          var MyHome = new layout();
          MyHome.init();

          var count = 0;

          app.ticker.add(function() {

              count += 0.05;

              var blur = Math.cos(count);

              MyHome.addTool.setDropShadowFilter(30 * blur);

          });


     $(document).ready(function(){

          $('#photo').on('change', function uploadfile(){



                 // var input = event.target;

                 var dataURL = '';
                  var reader = new FileReader();

                  reader.onloadend = function(){
                    console.log(reader);
                      dataURL = reader.result;
                   // var output = document.getElementById('photoTmp');
                  //  output.src = dataURL;           
                  var card = new PIXI.Container();

                  var backgroundCard = new PIXI.Graphics();
                  backgroundCard.beginFill(0xFFFFFF);
                  backgroundCard.lineStyle(0);
                  backgroundCard.drawRect(50, 50, window.innerWidth - 100, window.innerHeight - 100);
                  backgroundCard.endFill();

                  backgroundCard.interactive = true;

                  card.addChild(backgroundCard);


                     var pict = new PIXI.Sprite.fromImage(dataURL);
            pict.width = window.innerWidth - 120;
            pict.height = window.innerWidth - 120;
            pict.x = 60;
            pict.y = 60;
            //pict.anchor.set(0.5);
            pict.rotation = 1.5705;

            console.log(pict);
            card.addChild(pict);
            app.stage.addChild(card);

            $("#divText").show();

                  };

                 // reader.readAsDataURL($);

/*            console.log(pict);
            app.stage.addChild(pict);
*/
 

           



                 reader.readAsDataURL($('#photo')[0].files[0]);

            console.log(reader);
            console.log(reader.result);
            $('#photoTmp').attr('src',reader.result);

            function sleep(seconds){
                var waitUntil = new Date().getTime() + seconds;
                while(new Date().getTime() < waitUntil) true;
            }



/*            i = 0;
            while (i < 100 && reader.readyState < 2) {
              console.log(reader.readyState);
console.log(i);
i++;
            sleep(100);
            }*/

/*            var image = new Image();
            image.src = reader.result;*/

            //var myBaseTexture = new PIXI.BaseTexture(reader.readAsDataURL($('#photo')[0].files[0]));
            //var texture = new PIXI.Texture(myBaseTexture);

            // then add to the cache (if required)
           // PIXI.Texture.addTextureToCache(texture, "someId");

//console.log(texture);
/*            var pict = new PIXI.Sprite.fromImage(reader.readAsDataURL($('#photo')[0].files[0]));
            pict.width = 300;
            pict.height = 300;


            console.log(pict);
            app.stage.addChild(pict);
            console.log('after app stage');*/


            var formData = new FormData();

            formData.append('jpg'  ,$('#photo')[0].files[0]);

            var test = $.ajax({
              type: 'POST',
              url: 'data',
              data: formData,
                          async: true,
                          cache: false,
                          contentType: false,
                          processData: false
            });


          });

        });
    </script>

  </html>
